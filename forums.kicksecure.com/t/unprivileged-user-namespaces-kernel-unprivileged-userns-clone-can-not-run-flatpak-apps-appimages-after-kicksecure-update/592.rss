<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
    <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592</link>
    <description>Can not run flatpak apps after Kicksecure update

/usr/bin/flatpak run --branch=stable --arch=x86_64 --command=raider com.github.ADBeveridge.Raider
bwrap: No permissions to create new namespace, likely because the kernel does not allow non-privileged user namespaces.</description>
    
    <lastBuildDate>Sun, 12 Jan 2025 17:29:13 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Documented in the wiki just now:</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.kicksecure.com/wiki/User_Namespace">
  <header class="source">
      <img src="https://www.kicksecure.com/favicon.svg?hsversion-headscript-replacement-by-server=1&amp;hsversion_from_server_replacement_unixtime=1736674227" class="site-icon" width="151" height="151">

      <a href="https://www.kicksecure.com/wiki/User_Namespace" target="_blank" rel="noopener" title="05:16PM - 12 January 2025">Kicksecure – 12 Jan 25</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/387;"><img src="https://www.kicksecure.com/w/images/5/51/Kicksecure-image-twitter-post.jpg?version=30a0ad75271a4836786771c345c960b8" class="thumbnail" width="690" height="388"></div>

<h3><a href="https://www.kicksecure.com/wiki/User_Namespace" target="_blank" rel="noopener">Unprivileged User Namespace</a></h3>

  <p>Unprivileged user namespaces (userns) enable non-root users to create isolated environments but also pose security risks. Learn the implications and how to disable them in Kicksecure.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/26">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/26</link>
        <pubDate>Sun, 12 Jan 2025 17:29:13 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-26</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Not enabling unprivileged namespaces will create a Firefox warning message.</p>
<p>Quote <a href="https://wiki.mozilla.org/Security/Sandbox/Specifics" class="inline-onebox">Security/Sandbox/Specifics - MozillaWiki</a></p>
<blockquote>
<p>We’re using unprivileged user namespaces for additional security where available;</p>
</blockquote>
<p>Also mentioned on <a href="https://support.mozilla.org/en-US/kb/install-firefox-linux" class="inline-onebox">Install Firefox on Linux | Firefox Help</a></p>
<hr>
<p>If unpriviledged namespaces are disabled, this can also cause a warning for Tor Browser, that was reported here:</p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="https://forums.kicksecure.com/uploads/default/original/1X/74fa109772e3e102d50dd23f2dcb8f013df23074.png" data-download-href="https://forums.kicksecure.com/uploads/default/74fa109772e3e102d50dd23f2dcb8f013df23074" title="Some_of_Tor_Browser_security_features_may_offer_less_protection_on_your_current_operating_system"><img src="https://forums.kicksecure.com/uploads/default/optimized/1X/74fa109772e3e102d50dd23f2dcb8f013df23074_2_690x106.png" alt="Some_of_Tor_Browser_security_features_may_offer_less_protection_on_your_current_operating_system" data-base62-sha1="gGP9aKFS7HTYJLEhXSp7MLauBLK" width="690" height="106" srcset="https://forums.kicksecure.com/uploads/default/optimized/1X/74fa109772e3e102d50dd23f2dcb8f013df23074_2_690x106.png, https://forums.kicksecure.com/uploads/default/original/1X/74fa109772e3e102d50dd23f2dcb8f013df23074.png 1.5x, https://forums.kicksecure.com/uploads/default/original/1X/74fa109772e3e102d50dd23f2dcb8f013df23074.png 2x" data-dominant-color="EAEAEC"></a></div><p></p>
<aside class="onebox discoursetopic" data-onebox-src="https://forums.whonix.org/t/some-of-tor-browsers-security-features-may-offer-less-protection-on-your-current-operating-system/20699">
  <header class="source">
      <img src="https://forums.whonix.org/uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico" class="site-icon" width="32" height="32">

      <a href="https://forums.whonix.org/t/some-of-tor-browsers-security-features-may-offer-less-protection-on-your-current-operating-system/20699" target="_blank" rel="noopener" title="04:20PM - 06 November 2024">Whonix Forum – 6 Nov 24</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/106;"><img src="https://forums.kicksecure.com/uploads/default/optimized/1X/74fa109772e3e102d50dd23f2dcb8f013df23074_2_690x106.png" class="thumbnail" width="690" height="106" data-dominant-color="EAEAEC"></div>

<div class="title-wrapper">
  <h3><a href="https://forums.whonix.org/t/some-of-tor-browsers-security-features-may-offer-less-protection-on-your-current-operating-system/20699" target="_blank" rel="noopener">"Some of Tor Browser's security features may offer less protection on your...</a></h3>
  <div class="topic-category">
      <span class="badge-wrapper bullet">
        <span class="badge-category-bg" style="background-color: #8C6238;"></span>
        <span class="badge-category clear-badge">
          <span class="category-name">Support</span>
        </span>
      </span>
  </div>
</div>

  <p>[234808]</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/25">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/25</link>
        <pubDate>Wed, 06 Nov 2024 17:12:15 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-25</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[qtzvytqr77x4t5cq]]></dc:creator>
        <description><![CDATA[
            <p>I do not know about appimage. For flatpak, I have been suspicious about their sandbox ever since I read flatkill website (<a href="https://flatkill.org/" rel="noopener nofollow ugc">https://flatkill.org/</a> and <a href="https://flatkill.org/2020/" rel="noopener nofollow ugc">https://flatkill.org/2020/</a>). Also see <a href="https://madaidans-insecurities.github.io/linux.html#flatpak" class="inline-onebox" rel="noopener nofollow ugc">Linux | Madaidan's Insecurities</a>.</p>
<p>Either way, today I started getting a warning saying that tor browser might not be as secure in my operating system configurations. This was because I set kernel.unprivileged_userns_clone=0 using previous instructions. See <a href="https://gitlab.torproject.org/tpo/applications/tor-browser/-/issues/43101" class="inline-onebox" rel="noopener nofollow ugc">Security features warning links to Firefox installation support page with incomplete info (#43101) · Issues · The Tor Project / Applications / Tor Browser · GitLab</a> and <a href="https://support.mozilla.org/en-US/kb/install-firefox-linux?as=u&amp;utm_source=inproduct#w_security-features-warning" class="inline-onebox" rel="noopener nofollow ugc">Install Firefox on Linux | Firefox Help</a>.</p>
<p>I deleted /etc/sysctl.d/99-disable-unpriv-userns.conf (created using previous instructions), and now I do not get the warning. So I guess that is another reason to prefer kernel.unprivileged_userns_clone=1.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/22">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/22</link>
        <pubDate>Tue, 22 Oct 2024 23:03:33 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-22</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Added a new wiki chapter to the <a href="https://www.kicksecure.com/wiki/Security-misc">security-misc</a> wiki page just now:<br>
<a href="https://www.kicksecure.com/wiki/Security-misc#Optional_Features">Optional Features</a>.</p>
<p>It’s suggesting to check optional features by security-misc (security related, commented-out by default sysctl and kernel parameters).</p>
<p>This includes <code>kernel.unprivileged_userns_clone=0</code>, <code>user.max_user_namespaces=0</code>.</p>
<p>Also added a link to that wiki chapter on the <a href="https://www.kicksecure.com/wiki/System_Hardening_Checklist" class="inline-onebox">System Hardening Checklist</a> wiki page just now.</p>
<aside class="quote no-group" data-username="qtzvytqr77x4t5cq" data-post="19" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/q/a4c791/48.png" class="avatar"> qtzvytqr77x4t5cq:</div>
<blockquote>
<p>Anyways, I am not so much offering a recommendation as I am offering a potential way to make appimages work under kernel.unprivileged_userns_clone=0.</p>
</blockquote>
</aside>
<p>The question arises, is it worth it? What’s better:</p>
<ul>
<li>A) <code>kernel.unprivileged_userns_clone=1</code> + sandbox enabled; OR</li>
<li>B) <code>kernel.unprivileged_userns_clone=0</code> + sandbox disabled?</li>
</ul>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/21">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/21</link>
        <pubDate>Sat, 05 Oct 2024 08:21:09 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-21</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[linuxer]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="qtzvytqr77x4t5cq" data-post="17" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/q/a4c791/48.png" class="avatar"> qtzvytqr77x4t5cq:</div>
<blockquote>
<p>I am sympathetic to nurmagoz’s reasoning here. If kernel.unprivileged_userns_clone=0 helps security, I would think it would be good to have it that way by default for a security-oriented distribution. Users who want to use flatpak can look at documentation on how to make it kernel.unprivileged_userns_clone=1 in order to use flatpak. However, I have alternatives to flatpak that suit my needs, so I guess I am biased.</p>
</blockquote>
</aside>
<p>TOR browser is focused on security. But by default, all scripts in noscript are not disabled - only most basic protection. If you want max protection - change settings. Here is a similar situation, OS should be convenient for new users</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/20">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/20</link>
        <pubDate>Fri, 04 Oct 2024 17:02:29 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-20</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[qtzvytqr77x4t5cq]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="18" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/p/b2d939/48.png" class="avatar"> Patrick Schleizer:</div>
<blockquote>
<p>Without looking into the details… A sandbox is “usually” a security feature. <code>--no-sandbox</code> would disable the sandbox, i.e. would disable a security feature.</p>
</blockquote>
</aside>
<p>Yes, it would disable a security feature. Presumably, setting kernel.unprivileged_userns_clone=1 instead of 0 is also disabling a security feature. Anyways, I am not so much offering a recommendation as I am offering a potential way to make appimages work under kernel.unprivileged_userns_clone=0. This is because previous comments said that some appimages were not working under kernel.unprivileged_userns_clone=0.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/19">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/19</link>
        <pubDate>Fri, 04 Oct 2024 14:40:46 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-19</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="nurmagoz" data-post="15" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/n/8e7dd6/48.png" class="avatar"> nurmagoz:</div>
<blockquote>
<p>how come this is a good security decision for the users? this is a degrade to the security for just user self satisfactory.</p>
</blockquote>
</aside>
<p><code>kernel.unprivileged_userns_clone=1</code> by default incompatible with project goals. There was <a href="https://www.kicksecure.com/wiki/Stable_Version_User_Experience" class="inline-onebox">Kicksecure Stable Version User Experience</a> but on the same page I elaborated just now and added a new wiki chapter, <a href="https://www.kicksecure.com/wiki/Stable_Version_User_Experience#Security_versus_Usability">Security versus Usability</a>.</p>
<aside class="quote no-group" data-username="qtzvytqr77x4t5cq" data-post="17" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/q/a4c791/48.png" class="avatar"> qtzvytqr77x4t5cq:</div>
<blockquote>
<p>In regards to appimages breaking, wouldn’t the “–no-sandbox” option for appimages solve the problem?</p>
</blockquote>
</aside>
<p>Without looking into the details… A sandbox is “usually” a security feature. <code>--no-sandbox</code> would disable the sandbox, i.e. would disable a security feature.</p>
<aside class="quote no-group" data-username="arraybolt3" data-post="16" data-topic="592" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/user_avatar/forums.kicksecure.com/arraybolt3/48/88_2.png" class="avatar"> arraybolt3:</div>
<blockquote>
<p>FWIW Ubuntu implemented a very similar policy to this using AppArmor. I don’t think Debian 12 will have the needed code for it to work, but their solution to this issue was to make AppArmor able to grant unprivileged user namespace creation privileges to individual apps via AppArmor policies. This is documented at <a href="https://discourse.ubuntu.com/t/ubuntu-24-04-lts-noble-numbat-release-notes/39890#unprivileged-user-namespace-restrictions">Ubuntu 24.04 LTS (Noble Numbat) Release Notes - Release - Ubuntu Community Hub</a>. Sadly, this solution is not easy to use with AppImages.</p>
<p>IMO it would be worthwhile figuring out how to disable unprivileged userns creation in Kicksecure in a way that doesn’t render many apps unusable. Perhaps if Trixie has the needed code for using AppArmor policies for this, a permissions-granting app could be created and used here.</p>
</blockquote>
</aside>
<p>This can be future work.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/18">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/18</link>
        <pubDate>Fri, 04 Oct 2024 11:32:33 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-18</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[qtzvytqr77x4t5cq]]></dc:creator>
        <description><![CDATA[
            <p>I am sympathetic to nurmagoz’s reasoning here. If kernel.unprivileged_userns_clone=0 helps security, I would think it would be good to have it that way by default for a security-oriented distribution. Users who want to use flatpak can look at documentation on how to make it kernel.unprivileged_userns_clone=1 in order to use flatpak. However, I have alternatives to flatpak that suit my needs, so I guess I am biased.</p>
<p>In regards to appimages breaking, wouldn’t the “–no-sandbox” option for appimages solve the problem? For example, under kernel.unprivileged_userns_clone=0, my appimage for FreeTube does not work if I go to the terminal and type “./freetube_0.21.3_amd64.AppImage”. However, it does work if I type “./freetube_0.21.3_amd64.AppImage --no-sandbox”. Would the appimages that the other commenters are talking about work with the “–no-sandbox” option?</p>
<p>Regardless, I decided to go in and follow nurmagoz’s quoted instructions. However, the command was not working for me.</p>
<pre><code class="lang-auto">
user@host:~$ echo kernel.unprivileged_userns_clone=0 | \ sudo tee /etc/sysctl.d/99-disable-unpriv-userns.conf

-bash: sudo: command not found

user@host:~$ sudo -i

[sudo] password for user:

root@host:~# echo kernel.unprivileged_userns_clone=0 | \ tee /etc/sysctl.d/99-disable-unpriv-userns.conf

-bash: tee: command not found
</code></pre>
<p>I do not know why it was not working. So I ran this command instead to disable it.</p>
<pre><code class="lang-auto">
user@host:~$ sudo -i

[sudo] password for user:

root@host:~# echo kernel.unprivileged_userns_clone=0 &gt; /etc/sysctl.d/99-disable-unpriv-userns.conf
</code></pre>
<p>That command works. So if anyone wants to set kernel.unprivileged_userns_clone=0 instead of the current default of kernel.unprivileged_userns_clone=1, they can do it that way.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/17">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/17</link>
        <pubDate>Fri, 04 Oct 2024 05:35:47 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-17</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[arraybolt3]]></dc:creator>
        <description><![CDATA[
            <p>FWIW Ubuntu implemented a very similar policy to this using AppArmor. I don’t think Debian 12 will have the needed code for it to work, but their solution to this issue was to make AppArmor able to grant unprivileged user namespace creation privileges to individual apps via AppArmor policies. This is documented at <a href="https://discourse.ubuntu.com/t/ubuntu-24-04-lts-noble-numbat-release-notes/39890#unprivileged-user-namespace-restrictions" class="inline-onebox" rel="noopener nofollow ugc">Ubuntu 24.04 LTS (Noble Numbat) Release Notes - Release - Ubuntu Community Hub</a>. Sadly, this solution is not easy to use with AppImages.</p>
<p>IMO it would be worthwhile figuring out how to disable unprivileged userns creation in Kicksecure in a way that doesn’t render many apps unusable. Perhaps if Trixie has the needed code for using AppArmor policies for this, a permissions-granting app could be created and used here.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/16">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/16</link>
        <pubDate>Fri, 04 Oct 2024 00:12:43 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-16</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[nurmagoz]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="12" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/p/b2d939/48.png" class="avatar"> Patrick Schleizer:</div>
<blockquote>
<p>But that will also break flatpak.</p>
</blockquote>
</aside>
<p>It doesnt matter, break flatpak or break thunderbird… idea is that this option preventing malicious attacks, breaking it for app/s satisfactory is security nonsense.</p>
<p>workaround mean either giving user extra (even if insecure) instructions because this is user decision to decide or a workaround that can be implemented but keeps up the same security level.</p>
<aside class="quote no-group quote-modified" data-username="Patrick" data-post="12" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/p/b2d939/48.png" class="avatar"> Patrick Schleizer:</div>
<blockquote>
<p>no longer set <code>kernel.unprivileged_userns_clone=0</code> · Kicksecure/security-misc@0e3ffa3 · GitHub</p>
</blockquote>
</aside>
<p>how come this is a good security decision for the users? this is a degrade to the security for just user self satisfactory.</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://opensourcewatch.beehiiv.com/p/nasty-linux-bug-cve20241086-loose">
  <header class="source">
      <img src="https://media.beehiiv.com/cdn-cgi/image/fit=scale-down,format=auto,onerror=redirect,quality=80/uploads/publication/logo/479c6f06-175e-4e93-9da8-13db93b55923/thumb_sjvn.jpeg.256x256_q100_crop-smart.jpg" class="site-icon" width="200" height="200">

      <a href="https://opensourcewatch.beehiiv.com/p/nasty-linux-bug-cve20241086-loose" target="_blank" rel="noopener">Open Source Watch</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/361;"><img src="https://beehiiv-images-production.s3.amazonaws.com/uploads/asset/file/b25157dc-a462-46d7-9b0a-fc2397fa0c8e/Bug_vs._Tux.jpg?t=1717370564" class="thumbnail" width="500" height="500"></div>

<h3><a href="https://opensourcewatch.beehiiv.com/p/nasty-linux-bug-cve20241086-loose" target="_blank" rel="noopener">Nasty Linux Bug, CVE-2024-1086, is on the loose</a></h3>

  <p>I thought we'd fixed this, but recent reports indicate it's alive, well, and screwing systems over everywhere.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<blockquote>
<p>But, if you can’t patch it or think there may indeed be a new version of the vulnerability out there? In that case, you can mitigate it by disabling the ability for unprivileged users to create namespaces. To do this temporarily, in the Debian/Ubuntu world run:</p>
<p>$ sudo sysctl -w kernel.unprivileged_userns_clone=0</p>
<p>To disable it for once and all:</p>
<p>echo kernel.unprivileged_userns_clone=0 | \ sudo tee /etc/sysctl.d/99-disable-unpriv-userns.conf</p>
<p>Personally, I’ve never been keen on granting unprivileged users the ability to create namespaces. As a wise admin once said, <a href="https://security.stackexchange.com/questions/209529/what-does-enabling-kernel-unprivileged-userns-clone-do?utm_source=opensourcewatch.beehiiv.com&amp;utm_medium=referral&amp;utm_campaign=nasty-linux-bug-cve-2024-1086-is-on-the-loose">"Unless you truly need it, just disable it.</a>"</p>
</blockquote>
<p>Nasty.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/15">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/15</link>
        <pubDate>Thu, 03 Oct 2024 15:11:41 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-15</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[sam]]></dc:creator>
        <description><![CDATA[
            <p>Thank you very much! I really like this update - it fixed old bugs, and now flatpak works. Kicksecure works great even on my kde plasma <img src="https://forums.kicksecure.com/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/14">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/14</link>
        <pubDate>Thu, 03 Oct 2024 11:31:22 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-14</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group quote-modified" data-username="Patrick" data-post="12" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/p/b2d939/48.png" class="avatar"> Patrick Schleizer:</div>
<blockquote>
<p><a href="https://github.com/Kicksecure/security-misc/commit/0e3ffa3f11a0049e57803c8f2e75dbb7d8ceb22c" class="inline-onebox">no longer set `kernel.unprivileged_userns_clone=0` · Kicksecure/security-misc@0e3ffa3 · GitHub</a></p>
</blockquote>
</aside>
<p>This is now in all Kicksecure repositories.</p>
<p>This means after updates + reboot this issue will be resolved.</p>
<p>Update → <a href="https://www.kicksecure.com/wiki/Operating_System_Software_and_Updates" class="inline-onebox">Operating System Software and Updates</a></p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/13">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/13</link>
        <pubDate>Thu, 03 Oct 2024 09:20:24 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-13</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>This has been reverted in git:</p>
<aside class="onebox githubcommit" data-onebox-src="https://github.com/Kicksecure/security-misc/commit/0e3ffa3f11a0049e57803c8f2e75dbb7d8ceb22c">
  <header class="source">

      <a href="https://github.com/Kicksecure/security-misc/commit/0e3ffa3f11a0049e57803c8f2e75dbb7d8ceb22c" target="_blank" rel="noopener">github.com/Kicksecure/security-misc</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Kicksecure/security-misc/commit/0e3ffa3f11a0049e57803c8f2e75dbb7d8ceb22c" target="_blank" rel="noopener">no longer set `kernel.unprivileged_userns_clone=0`</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2024-10-03" data-time="06:58:58" data-timezone="UTC">06:58AM - 03 Oct 24 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>

      <div class="lines" title="changed 2 files with 11 additions and 8 deletions">
        <a href="https://github.com/Kicksecure/security-misc/commit/0e3ffa3f11a0049e57803c8f2e75dbb7d8ceb22c" target="_blank" rel="noopener">
          <span class="added">+11</span>
          <span class="removed">-8</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">because it breaks too much

fixes https://github.com/Kicksecure/security-misc/is<span class="show-more-container"><a href="https://github.com/Kicksecure/security-misc/commit/0e3ffa3f11a0049e57803c8f2e75dbb7d8ceb22c" target="_blank" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">sues/274</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<hr>
<p>Background information for developers:</p>
<p><code>kernel.unprivileged_userns_clone=0</code> is a Debian specific kernel feature. Not in Linux mainline.</p>
<p>Why Kicksecure-Qubes (and therefore Qubes-Whonix) is unaffected? Because it uses dom0 kernel by Qubes default. And Qubes dom0 provided kernel is not a Debian kernel. Related: <a href="https://github.com/QubesOS/qubes-issues/issues/5212" class="inline-onebox">Simplify and promote using in-vm kernel · Issue #5212 · QubesOS/qubes-issues · GitHub</a></p>
<p><a href="https://kspp.github.io/Recommended_Settings.html" class="inline-onebox">Recommended Settings | Linux Kernel Self-Protection Project</a> recommends:</p>
<blockquote>
<pre><code class="lang-auto"># Disable User Namespaces, as it opens up a large attack surface to unprivileged users.
user.max_user_namespaces = 0
</code></pre>
</blockquote>
<p>But that will also break flatpak. To break flatpak temporarily, run: <code>sudo sysctl -w user.max_user_namespaces=0</code>. To unbreak, reboot or <code>sudo sysctl -w user.max_user_namespaces=3643</code>. Where number <code>3643</code> is coming from?  That’s the default that can be seen using: <code>sysctl -a | grep user.max_user_namespaces</code></p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/12">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/12</link>
        <pubDate>Thu, 03 Oct 2024 07:17:12 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-12</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="nurmagoz" data-post="9" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/n/8e7dd6/48.png" class="avatar"> nurmagoz:</div>
<blockquote>
<p>But they say if you have flatpak permission issue just " add your user to the <strong>flatpak</strong> group."</p>
<p><a href="https://wiki.alpinelinux.org/wiki/Flatpak#Permission_errors">https://wiki.alpinelinux.org/wiki/Flatpak#Permission_errors </a></p>
</blockquote>
</aside>
<p>Not clear what this is about since they failed to show the error message. I don<br>
t think it’ not a permission issue. The error message is very clear and links to documentation. Permission issue would probably be a different issue. On Debian, there is no <code>flatpak</code> linux user group.</p>
<aside class="quote no-group" data-username="nurmagoz" data-post="9" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/n/8e7dd6/48.png" class="avatar"> nurmagoz:</div>
<blockquote>
<p>Why turning off this option is not solution:</p>
</blockquote>
</aside>
<p>There are only two solutions. Debian and Flatpak are very clear about it. References:</p>
<ul>
<li><a href="https://github.com/flatpak/flatpak/wiki/User-namespace-requirements" class="inline-onebox">User namespace requirements · flatpak/flatpak Wiki · GitHub</a></li>
<li><a href="https://salsa.debian.org/debian/bubblewrap/-/blob/debian/latest/debian/README.Debian" class="inline-onebox">debian/README.Debian · debian/latest · Debian / bubblewrap · GitLab</a></li>
</ul>
<p>The only options are,</p>
<ul>
<li>A) bubblewrap SUID; or</li>
<li>B) <code>kernel.unprivileged_userns_clone=1</code> Linux sysctl; or</li>
<li>C) Not using Flatpak.</li>
</ul>
<p>As for <code>bubblewrap SUID</code>, quote Flatpak documenation:</p>
<blockquote>
<p>This mode is not recommended, and some Flatpak apps and features will not work.</p>
</blockquote>
<p>Quote Debian readme:</p>
<blockquote>
<p>This can be a security risk: if there are bugs in bubblewrap, it might be<br>
possible for an unprivileged user to get root privileges by running a<br>
setuid version of the bwrap executable. CVE-2020-5291 and CVE-2016-8659<br>
are examples of bugs that had this effect in the past. However, it allows<br>
the kernel to be configured to disallow creation of user namespaces by<br>
unprivileged users, which prevents attacks like CVE-2016-3135 from being<br>
carried out against the kernel. This is a trade-off between different<br>
security risks.</p>
</blockquote>
<p>Quote Flatpak documentation:</p>
<blockquote>
<p>This is a security trade-off. Disallowing unprivileged use of user namespaces reduces the kernel’s attack surface, which mitigates some attacks; but it also disallows some sandboxing techniques, which prevents other attacks from being mitigated. Making <code>bwrap</code> or <code>flatpak-bwrap</code> setuid root also carries some risk: an attacker might be able to exploit vulnerabilities in <code>bwrap</code> to achieve root privilege escalation.</p>
</blockquote>
<p>So there is no perfect solution. However, since SUID is being discouraged by Flatpak, the choice is simple: B) <code>kernel.unprivileged_userns_clone=1</code> Linux sysctl.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/11">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/11</link>
        <pubDate>Thu, 03 Oct 2024 06:12:33 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-11</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[cookie.monster]]></dc:creator>
        <description><![CDATA[
            <p>I confirm the workaround worked, thanks</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/10">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/10</link>
        <pubDate>Thu, 03 Oct 2024 02:03:18 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-10</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[nurmagoz]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="7" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/p/b2d939/48.png" class="avatar"> Patrick Schleizer:</div>
<blockquote>
<p>security-misc changed in this release:</p>
<p><code>kernel.unprivileged_userns_clone=0</code></p>
</blockquote>
</aside>
<p>This is good to have and kept as default, something else should be figured out on how to make flatpak work.</p>
<p>Alpinelinux using the same kernel option:</p>
<aside class="onebox stackexchange" data-onebox-src="https://superuser.com/questions/1507236/enable-kernel-unprivileged-userns-clone-in-alpine-linux">
  <header class="source">

      <a href="https://superuser.com/questions/1507236/enable-kernel-unprivileged-userns-clone-in-alpine-linux" target="_blank" rel="noopener">superuser.com</a>
  </header>

  <article class="onebox-body">
      <a href="https://superuser.com/users/1118308/pjeremymalouf" target="_blank" rel="noopener">
    <img alt="PJeremyMalouf" src="https://www.gravatar.com/avatar/6c09cba963c7e78e35f4755062697395?s=256&amp;d=identicon&amp;r=PG" class="thumbnail onebox-avatar" width="256" height="256">
  </a>

<h4>
  <a href="https://superuser.com/questions/1507236/enable-kernel-unprivileged-userns-clone-in-alpine-linux" target="_blank" rel="noopener">Enable kernel.unprivileged_userns_clone in Alpine Linux</a>
</h4>

<div class="tags">
  <strong>docker, amazon-web-services, alpine-linux</strong>
</div>

<div class="date">
  asked by
  
  <a href="https://superuser.com/users/1118308/pjeremymalouf" target="_blank" rel="noopener">
    PJeremyMalouf
  </a>
  on <a href="https://superuser.com/questions/1507236/enable-kernel-unprivileged-userns-clone-in-alpine-linux" target="_blank" rel="noopener">06:49AM - 04 Dec 19 UTC</a>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>But they say if you have flatpak permission issue just " add your user to the <strong>flatpak</strong> group."</p>
<p><a href="https://wiki.alpinelinux.org/wiki/Flatpak#Permission_errors" class="onebox" target="_blank" rel="noopener">https://wiki.alpinelinux.org/wiki/Flatpak#Permission_errors</a></p>
<p>Why turning off this option is not solution:</p>
<aside class="onebox stackexchange" data-onebox-src="https://security.stackexchange.com/questions/209529/what-does-enabling-kernel-unprivileged-userns-clone-do/209533#209533">
  <header class="source">

      <a href="https://security.stackexchange.com/questions/209529/what-does-enabling-kernel-unprivileged-userns-clone-do/209533#209533" target="_blank" rel="noopener">security.stackexchange.com</a>
  </header>

  <article class="onebox-body">
      <a href="https://security.stackexchange.com/users/106285/forest" target="_blank" rel="noopener">
    <img alt="forest" src="https://i.sstatic.net/mVwQm.jpg?s=256" class="thumbnail onebox-avatar" width="256" height="256">
  </a>

<h4>
  <a href="https://security.stackexchange.com/questions/209529/what-does-enabling-kernel-unprivileged-userns-clone-do/209533#209533" target="_blank" rel="noopener">What does enabling kernel.unprivileged_userns_clone do?</a>
</h4>

<div class="tags">
  <strong>linux</strong>
</div>

<div class="date">
  
  answered by
  <a href="https://security.stackexchange.com/users/106285/forest" target="_blank" rel="noopener">
    forest
  </a>
  on <a href="https://security.stackexchange.com/questions/209529/what-does-enabling-kernel-unprivileged-userns-clone-do/209533#209533" target="_blank" rel="noopener">01:41AM - 05 May 19 UTC</a>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="quote no-group" data-username="Patrick" data-post="7" data-topic="592">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://forums.kicksecure.com/letter_avatar_proxy/v4/letter/p/b2d939/48.png" class="avatar"> Patrick Schleizer:</div>
<blockquote>
<p>Temporary workaround to undo this setting (untested):</p>
<p><code>sudo sysctl -w kernel.unprivileged_userns_clone=1</code></p>
</blockquote>
</aside>
<p>Workaround, worked:</p>
<pre><code class="lang-auto">[user ~]% sudo sysctl -w kernel.unprivileged_userns_clone=1
kernel.unprivileged_userns_clone = 1
[user ~]% flatpak install org.mozilla.firefox
Looking for matches…
Required runtime for org.mozilla.firefox/x86_64/stable (runtime/org.freedesktop.Platform/x86_64/23.08) found in remote flathub
Do you want to install it? [Y/n]: n 
error: The application org.mozilla.firefox/x86_64/stable requires the runtime org.freedesktop.Platform/x86_64/23.08 which is not installed
zsh: exit 1     flatpak install org.mozilla.firefox
[user ~]% flatpak install io.freetubeapp.FreeTube
Looking for matches…
Required runtime for io.freetubeapp.FreeTube/x86_64/stable (runtime/org.freedesktop.Platform/x86_64/23.08) found in remote flathub
Do you want to install it? [Y/n]: y

io.freetubeapp.FreeTube permissions:
    ipc        network                pulseaudio             x11
    dri        file access [1]        dbus access [2]        bus ownership [3]

    [1] xdg-download
    [2] org.freedesktop.PowerManagement, org.freedesktop.ScreenSaver, org.gnome.SessionManager,
        org.gnome.SettingsDaemon
    [3] org.mpris.MediaPlayer2.chromium.*, org.mpris.MediaPlayer2.freetube


        ID                                     Branch         Op    Remote    Download
 1. [✓] org.freedesktop.Platform.GL.default    23.08          i     flathub   164.6 MB / 163.8 MB
 2. [✓] org.freedesktop.Platform.GL.default    23.08-extra    i     flathub    22.6 MB / 163.8 MB
 3. [✓] org.freedesktop.Platform.Locale        23.08          i     flathub    17.9 kB / 371.6 MB
 4. [✓] org.freedesktop.Platform.openh264      2.2.0          i     flathub     1.2 MB / 944.3 kB
 5. [✓] org.freedesktop.Platform               23.08          i     flathub   250.0 MB / 230.9 MB
 6. [✓] io.freetubeapp.FreeTube                stable         i     flathub   123.4 MB / 114.8 MB

Installation complete.
[user ~]%
</code></pre>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/9">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/9</link>
        <pubDate>Wed, 02 Oct 2024 23:33:08 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-9</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue" data-onebox-src="https://github.com/Kicksecure/security-misc/issues/274">
  <header class="source">

      <a href="https://github.com/Kicksecure/security-misc/issues/274" target="_blank" rel="noopener">github.com/Kicksecure/security-misc</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Kicksecure/security-misc/issues/274" target="_blank" rel="noopener">`kernel.unprivileged_userns_clone=0` breaks too much</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2024-10-02" data-time="17:09:37" data-timezone="UTC">05:09PM - 02 Oct 24 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="adrelanos" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">* https://forums.whonix.org/t/in-place-release-upgrade-to-whonix-17-2-3-7-seems-<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">to-have-broken-my-flatpaks/20486
* https://forums.kicksecure.com/t/cannot-run-some-appimage-apps-after-kicksecure-upate/594
* https://forums.kicksecure.com/t/impossible-to-start-evolution-app-since-the-last-update/601</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/8">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/8</link>
        <pubDate>Wed, 02 Oct 2024 17:09:52 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-8</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>security-misc changed in this release:</p>
<pre><code>kernel.unprivileged_userns_clone=0
</code></pre>
<p>Temporary workaround to undo this setting (untested):</p>
<pre><code>sudo sysctl -w kernel.unprivileged_userns_clone=1
</code></pre>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/7">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/7</link>
        <pubDate>Wed, 02 Oct 2024 17:02:17 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-7</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[sam]]></dc:creator>
        <description><![CDATA[
            <p>it security-misc. I checked. set it to debian and flatpak will stop working</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/6">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/6</link>
        <pubDate>Wed, 02 Oct 2024 15:31:36 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-6</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[arraybolt3]]></dc:creator>
        <description><![CDATA[
            <p>This sounds like either Kicksecure has a kernel built without unprivileged user namespace creation abilities, or a major AppArmor update came through that is disabling the feature. I’ll look into this later today most likely.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/5">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/5</link>
        <pubDate>Wed, 02 Oct 2024 14:54:27 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-5</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[nurmagoz]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox discoursetopic" data-onebox-src="https://forums.whonix.org/t/in-place-release-upgrade-to-whonix-17-2-3-7-seems-to-have-broken-my-flatpaks/20486">
  <header class="source">
      <img src="https://forums.whonix.org/uploads/default/optimized/2X/3/37fe81e592143b0c01c9656c44069b4bfdd3990e_2_32x32.ico" class="site-icon" width="32" height="32">

      <a href="https://forums.whonix.org/t/in-place-release-upgrade-to-whonix-17-2-3-7-seems-to-have-broken-my-flatpaks/20486" target="_blank" rel="noopener" title="06:28PM - 30 September 2024">Whonix Forum – 30 Sep 24</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/255;"><img src="https://forums.whonix.org/uploads/default/original/2X/5/5ac973ff4302e69269667e09e67d850c0b628c7a.jpeg" class="thumbnail" width="690" height="255"></div>

<div class="title-wrapper">
  <h3><a href="https://forums.whonix.org/t/in-place-release-upgrade-to-whonix-17-2-3-7-seems-to-have-broken-my-flatpaks/20486" target="_blank" rel="noopener">In-place release upgrade to Whonix 17.2.3.7 seems to have broken my flatpaks</a></h3>
  <div class="topic-category">
      <span class="badge-wrapper bullet">
        <span class="badge-category-bg" style="background-color: #8C6238;"></span>
        <span class="badge-category clear-badge">
          <span class="category-name">Support</span>
        </span>
      </span>
  </div>
</div>

  <p>Whonix workstation- virtualbox version  I upgraded my packages via the software manager. There were a lot of packages to install. I assume that was due to the Whonix 17.2.3.7 upgrade.  When I restarted Whonix later, I discovered that my flatpaks...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/4">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/4</link>
        <pubDate>Wed, 02 Oct 2024 14:24:50 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-4</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[sam]]></dc:creator>
        <description><![CDATA[
            <p>Yes. Flatpak and some Appimage cant run <img src="https://forums.kicksecure.com/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"></p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/3">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/3</link>
        <pubDate>Wed, 02 Oct 2024 05:33:56 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-3</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[cookie.monster]]></dc:creator>
        <description><![CDATA[
            <p>Issue confirmed for me too. Zero changes done on Flatpak apps, issue only occured after latest kicksecure piont release 17.2.3.7 update.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/2">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/2</link>
        <pubDate>Wed, 02 Oct 2024 01:58:45 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-2</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
      <item>
        <title>Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</title>
        <dc:creator><![CDATA[linuxer]]></dc:creator>
        <description><![CDATA[
            <p>Can not run flatpak apps after Kicksecure update</p>
<p>/usr/bin/flatpak run --branch=stable --arch=x86_64 --command=raider com.github.ADBeveridge.Raider<br>
bwrap: No permissions to create new namespace, likely because the kernel does not allow non-privileged user namespaces.</p>
          <p><a href="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/1">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592/1</link>
        <pubDate>Tue, 01 Oct 2024 16:21:52 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-592-1</guid>
        <source url="https://forums.kicksecure.com/t/unprivileged-user-namespaces-kernel-unprivileged-userns-clone-can-not-run-flatpak-apps-appimages-after-kicksecure-update/592.rss">Unprivileged user namespaces / kernel.unprivileged_userns_clone / Can not run flatpak apps / AppImages after Kicksecure update</source>
      </item>
  </channel>
</rss>
