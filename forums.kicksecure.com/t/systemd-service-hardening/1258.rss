<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Systemd Service Hardening?</title>
    <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258</link>
    <description>So I was learning about the options for Systemd services for restricting or in another word ‚Äúhardening‚Äù services.

This made me question does Kicksecure deploy certain hardening for it‚Äôs services or certain Kicksecure specific services?

These are some interesting options I will note here:

[`PrivateNetwork=yes/no`](https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#PrivateNetwork=) 
Gives the service its own network namespace. It can‚Äôt see or use the host‚Äôs network interfaces unless you explicitly bind sockets. Seems useful to prevent leaks or prevent services from being ran without networking?

[`PrivatePIDs=yes/no`](https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#PrivatePIDs=) 
Gives a service an isolated view of the process table, which is a useful ‚Äúdefense in depth‚Äù measure, especially for daemons that don‚Äôt need to inspect or manage other system processes.

[`PrivateTmp=yes/no`](https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#PrivateTmp=) 
Provides a private /tmp and /var/tmp for the service, isolating it from the host‚Äôs temporary directories. One service can‚Äôt read temporary files left by another service, which mitigates attacks that rely on guessing or stealing temp‚Äëfile names.

[`MemoryDenyWriteExecute=yes/no`](https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#MemoryDenyWriteExecute=) 
Remounts parts of the filesystem read‚Äëonly (or makes the whole tree read‚Äëonly) for the service. (helps mitigate code‚Äëinjection attacks).

[`ProtectSystem=full/strict/yes`](https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#ProtectSystem=) 
Remounts parts of the filesystem read‚Äëonly (or makes the whole tree read‚Äëonly) for the service.

There is many others but these few caught my eye.</description>
    
    <lastBuildDate>Sun, 19 Oct 2025 16:27:57 +0000</lastBuildDate>
    <category>Support</category>
    <atom:link href="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[Quiksilver]]></dc:creator>
        <description><![CDATA[
            <p>Wouldn‚Äôt <code>PrivateNetwork=yes</code> help certain services not leak leak identifiers host level identifiers such as MAC addresses, IP addresses, or routing tables? But then these would require their on veth and NAT rules to make outbound connections?</p>
<p><code>CapabilityBoundingSet=</code>, <code>ProtectSystem=</code>, <code>RestrictAddressFamilies=</code> would be good for <code>tor.service</code> and <code>i2p.service</code> hardening without breaking networking and routing for them.</p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/13">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/13</link>
        <pubDate>Sun, 19 Oct 2025 16:27:57 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-13</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue" data-onebox-src="https://github.com/Kicksecure/security-misc/issues/213">
  <header class="source">

      <a href="https://github.com/Kicksecure/security-misc/issues/213" target="_blank" rel="noopener">github.com/Kicksecure/security-misc</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Kicksecure/security-misc/issues/213" target="_blank" rel="noopener">Harden all system services by default</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2024-03-17" data-time="11:41:00" data-timezone="UTC">11:41AM - 17 Mar 24 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2025-09-16" data-time="12:36:43" data-timezone="UTC">12:36PM - 16 Sep 25 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/monsieuremre" target="_blank" rel="noopener">
          <img alt="" src="https://avatars.githubusercontent.com/u/130907164?v=4" class="onebox-avatar-inline" width="20" height="20">
          monsieuremre
        </a>
      </div>
    </div>

    <div class="labels">
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">Let's make use of systemd sandboxing mechanisms to harden all services by defaul<span class="show-more-container"><a href="" rel="noopener" class="show-more">‚Ä¶</a></span><span class="excerpt hidden">t, whitelisting any services where necessary.

* Big time advantage: not bothering to sandbox single services one by one, we sandbox everything as much as we can by default and exempt services where applicable. We can do this only for very obvious privileges that are only required by a very limited number of known services. It will still bring a lot of value in hardening.

* Step 1: Create a global hardened drop in for all services

Under ```/etc/systemd/system/service.d``` create ```25_security-misc.conf```, with the content:
```
[Service]
ProtectProc=invisible
ProcSubset=pid
NoNewPrivileges=true
SecureBits=noroot-locked
ProtectClock=true
ProtectHostname=true
RestrictNamespaces=true
LockPersonality=true
PrivateTmp=yes
ProtectHome=yes
ProtectKernelLogs=yes
ProtectKernelModules=yes
ProtectKernelTunables=yes
RestrictSUIDSGID=true
MemoryDenyWriteExecute=true
RemoveIPC=true
UMask=0077
# InaccessiblePaths=/sys
NoExecPaths=/
ExecPaths=/usr/sbin/ /usr/lib /usr/lib64 /usr/bin
PrivateDevices=true
```
* Step 2: Whitelist vital system components so that we don't actually die

* For common and used time synchronization daemons, such as systemd-timesyncd, create the following drop-in:
```
[Service]
ProtectClock=false
```
* For the systemd-login daemon, the following drop-in:
```
[Service]
ProcSubset=all
ProtectProc=false
```

* For systemd-modules-load and quite possibly other services, we need enable sticking modules to the kernel and stuff:
```
[Service]
ProtectKernelModules=yes
ProtectKernelTunables=yes
```

* For systemd-journald and auditd and if applicable other known logging daemons, the following drop in:
```
[Service]
ProtectKernelLogs=no
```

* This is an extensive list. ```RestrictNamespaces=true``` probably needs exemption for apt and possibly some other privileged things. 
* ```LockPersonality=true``` might break random virtual box things, so that might be left out if necessary.
* ```MemoryDenyWriteExecute=true``` might need exemption for desktop environments especially when using xorg, and probably some other things, for now not clear without testing.
* ```RemoveIPC=true``` will most certainly break xorg, so DE components that rely on xorg will need drop-ins.
* ```ProtectHostname``` needs an exception for services that need that for sure, what those are yet to be cleared.
* PrivateDevices need exemption for services that do mounting and unmounting, only a few of them are there. Mount units need no exception, only services do.
* Other things should not break anything given the exception drop-ins. Not tested this except for ProtectProc, which works as I intended. One exception drop-in does the job. So they might break more, and more exception drop-ins might be required. Will create a pull when I find the time to write a test version and actually test it.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox githubissue" data-onebox-src="https://github.com/systemd/systemd/issues/31833">
  <header class="source">

      <a href="https://github.com/systemd/systemd/issues/31833" target="_blank" rel="noopener">github.com/systemd/systemd</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/systemd/systemd/issues/31833" target="_blank" rel="noopener">Feature Request: Conditional Application of systemd Drop-In Files</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2024-03-17" data-time="17:04:38" data-timezone="UTC">05:04PM - 17 Mar 24 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          needs-discussion ü§î
        </span>
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          pid1
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">### Component

systemd

### Is your feature request related to a problem? Please<span class="show-more-container"><a href="" rel="noopener" class="show-more">‚Ä¶</a></span><span class="excerpt hidden"> describe

Currently, systemd supports the use of drop-in files to extend or override configuration settings for unit files. While systemd provides the `ConditionPathExists` directive to conditionally start a service based on the existence of a file or directory, there is no built-in mechanism to conditionally apply drop-in files based on custom conditions within those files.

It would be highly beneficial to have a feature in systemd that allows for the conditional application of drop-in files based on custom conditions. This would provide users with greater flexibility and control over the configuration of systemd units.

A specific example would be the following one:

* https://github.com/Kicksecure/security-misc/issues/213

Complex hardening would be enabled by default. But to easily opt-in/out the additional hardening, to simplify testing, a status file would be helpful.

### Describe the solution you'd like

Introduce a new directive, such as `ConditionDropIn`, that allows users to specify custom conditions within drop-in files themselves. This directive could accept a condition expression similar to other systemd directives, enabling users to define conditions based on various factors such as the existence of specific files, system properties, environment variables, or other runtime conditions.

Example:

`/lib/systemd/system/myservice.service.d/50_drop-in.conf`

```
[Service]
ConditionDropIn=Exists:/path/to/status/file

# Additional configuration specific to the condition, which is disregarded if the status file does not exist.
```

In this example, the drop-in file `50_user.conf` would only be applied if the file `/path/to/status/file` exists.


### Describe alternatives you've considered

Packaging, scripting.

### The systemd version you checked that didn't have the feature you are asking for

_No response_</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/12">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/12</link>
        <pubDate>Tue, 16 Sep 2025 12:37:37 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-12</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubissue" data-onebox-src="https://github.com/Kicksecure/security-misc/issues/213">
  <header class="source">

      <a href="https://github.com/Kicksecure/security-misc/issues/213" target="_blank" rel="noopener">github.com/Kicksecure/security-misc</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Kicksecure/security-misc/issues/213" target="_blank" rel="noopener">Harden all system services by default</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2024-03-17" data-time="11:41:00" data-timezone="UTC">11:41AM - 17 Mar 24 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2025-09-16" data-time="12:36:43" data-timezone="UTC">12:36PM - 16 Sep 25 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/monsieuremre" target="_blank" rel="noopener">
          <img alt="" src="https://avatars.githubusercontent.com/u/130907164?v=4" class="onebox-avatar-inline" width="20" height="20">
          monsieuremre
        </a>
      </div>
    </div>

    <div class="labels">
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">Let's make use of systemd sandboxing mechanisms to harden all services by defaul<span class="show-more-container"><a href="" rel="noopener" class="show-more">‚Ä¶</a></span><span class="excerpt hidden">t, whitelisting any services where necessary.

* Big time advantage: not bothering to sandbox single services one by one, we sandbox everything as much as we can by default and exempt services where applicable. We can do this only for very obvious privileges that are only required by a very limited number of known services. It will still bring a lot of value in hardening.

* Step 1: Create a global hardened drop in for all services

Under ```/etc/systemd/system/service.d``` create ```25_security-misc.conf```, with the content:
```
[Service]
ProtectProc=invisible
ProcSubset=pid
NoNewPrivileges=true
SecureBits=noroot-locked
ProtectClock=true
ProtectHostname=true
RestrictNamespaces=true
LockPersonality=true
PrivateTmp=yes
ProtectHome=yes
ProtectKernelLogs=yes
ProtectKernelModules=yes
ProtectKernelTunables=yes
RestrictSUIDSGID=true
MemoryDenyWriteExecute=true
RemoveIPC=true
UMask=0077
# InaccessiblePaths=/sys
NoExecPaths=/
ExecPaths=/usr/sbin/ /usr/lib /usr/lib64 /usr/bin
PrivateDevices=true
```
* Step 2: Whitelist vital system components so that we don't actually die

* For common and used time synchronization daemons, such as systemd-timesyncd, create the following drop-in:
```
[Service]
ProtectClock=false
```
* For the systemd-login daemon, the following drop-in:
```
[Service]
ProcSubset=all
ProtectProc=false
```

* For systemd-modules-load and quite possibly other services, we need enable sticking modules to the kernel and stuff:
```
[Service]
ProtectKernelModules=yes
ProtectKernelTunables=yes
```

* For systemd-journald and auditd and if applicable other known logging daemons, the following drop in:
```
[Service]
ProtectKernelLogs=no
```

* This is an extensive list. ```RestrictNamespaces=true``` probably needs exemption for apt and possibly some other privileged things. 
* ```LockPersonality=true``` might break random virtual box things, so that might be left out if necessary.
* ```MemoryDenyWriteExecute=true``` might need exemption for desktop environments especially when using xorg, and probably some other things, for now not clear without testing.
* ```RemoveIPC=true``` will most certainly break xorg, so DE components that rely on xorg will need drop-ins.
* ```ProtectHostname``` needs an exception for services that need that for sure, what those are yet to be cleared.
* PrivateDevices need exemption for services that do mounting and unmounting, only a few of them are there. Mount units need no exception, only services do.
* Other things should not break anything given the exception drop-ins. Not tested this except for ProtectProc, which works as I intended. One exception drop-in does the job. So they might break more, and more exception drop-ins might be required. Will create a pull when I find the time to write a test version and actually test it.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox githubissue" data-onebox-src="https://github.com/systemd/systemd/issues/31833">
  <header class="source">

      <a href="https://github.com/systemd/systemd/issues/31833" target="_blank" rel="noopener">github.com/systemd/systemd</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/systemd/systemd/issues/31833" target="_blank" rel="noopener">Feature Request: Conditional Application of systemd Drop-In Files</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2024-03-17" data-time="17:04:38" data-timezone="UTC">05:04PM - 17 Mar 24 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          needs-discussion ü§î
        </span>
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          pid1
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">### Component

systemd

### Is your feature request related to a problem? Please<span class="show-more-container"><a href="" rel="noopener" class="show-more">‚Ä¶</a></span><span class="excerpt hidden"> describe

Currently, systemd supports the use of drop-in files to extend or override configuration settings for unit files. While systemd provides the `ConditionPathExists` directive to conditionally start a service based on the existence of a file or directory, there is no built-in mechanism to conditionally apply drop-in files based on custom conditions within those files.

It would be highly beneficial to have a feature in systemd that allows for the conditional application of drop-in files based on custom conditions. This would provide users with greater flexibility and control over the configuration of systemd units.

A specific example would be the following one:

* https://github.com/Kicksecure/security-misc/issues/213

Complex hardening would be enabled by default. But to easily opt-in/out the additional hardening, to simplify testing, a status file would be helpful.

### Describe the solution you'd like

Introduce a new directive, such as `ConditionDropIn`, that allows users to specify custom conditions within drop-in files themselves. This directive could accept a condition expression similar to other systemd directives, enabling users to define conditions based on various factors such as the existence of specific files, system properties, environment variables, or other runtime conditions.

Example:

`/lib/systemd/system/myservice.service.d/50_drop-in.conf`

```
[Service]
ConditionDropIn=Exists:/path/to/status/file

# Additional configuration specific to the condition, which is disregarded if the status file does not exist.
```

In this example, the drop-in file `50_user.conf` would only be applied if the file `/path/to/status/file` exists.


### Describe alternatives you've considered

Packaging, scripting.

### The systemd version you checked that didn't have the feature you are asking for

_No response_</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/11">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/11</link>
        <pubDate>Tue, 16 Sep 2025 12:37:24 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-11</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[goose4]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Quiksilver" data-post="3" data-topic="1258">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://forums.kicksecure.com/user_avatar/forums.kicksecure.com/quiksilver/48/110_2.png" class="avatar"> Quiksilver:</div>
<blockquote>
<p>Couldn‚Äôt we create a CUPS drop in <code>/etc/systemd/system/cups.service.d/hardening.conf</code> that would apply some hardened options that would essentially mitigate:</p>
</blockquote>
</aside>
<p>As Patrick mentioned <code>/usr/lib/systemd/system</code> is better for distribution to ship.</p>
<p>Heres an idea here that looks like it would mitigate that</p>
<blockquote>
<p>By default, it is listed on UDP port 631 and is open to the world</p>
</blockquote>
<ul>
<li>Example service conf</li>
</ul>
<p><code>/usr/lib/systemd/system/cups.service.d/99-cups-harden.conf</code></p>
<pre><code class="lang-auto">[Service]
# Minimal capabilities ‚Äì only needed to bind to privileged ports (631)
CapabilityBoundingSet=CAP_NET_BIND_SERVICE

# Give CUPS its own network namespace ‚Äì no external network access
PrivateNetwork=yes

# Prevent the service from gaining new privileges (setuid, etc.)
NoNewPrivileges=yes

# Restrict network families ‚Äì only IPv4/IPv6 TCP, no UDP
RestrictAddressFamilies=AF_INET AF_INET6

# Bind only to the loopback interface (change to a specific IP if you need LAN access)
# The ExecStart line in the original unit already runs /usr/sbin/cupsd
# If you want to force a bind address at the service level uncomment
# ExecStart=
# ExecStart=/usr/sbin/cupsd -o Listen=127.0.0.1:631

# Filesystem protection ‚Äì keep CUPS from touching the rest of the system
ProtectSystem=full
PrivateTmp=yes
ReadOnlyPaths=/etc/cups
ReadWritePaths=/var/spool/cups /var/log/cups

# Drop any unnecessary privileges
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectControlGroups=yes
</code></pre>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/10">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/10</link>
        <pubDate>Mon, 15 Sep 2025 20:34:05 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-10</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[goose4]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="Patrick" data-post="5" data-topic="1258">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://forums.kicksecure.com/user_avatar/forums.kicksecure.com/patrick/48/165_2.png" class="avatar"> Patrick:</div>
<blockquote>
<p>/usr/lib/systemd/system</p>
</blockquote>
</aside>
<p>I was not even thinking about CUPS cause I even have a printer nor print anything. Might be something to look into <img src="https://forums.kicksecure.com/images/emoji/twitter/+1.png?v=14" title=":+1:" class="emoji" alt=":+1:" loading="lazy" width="20" height="20"></p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/9">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/9</link>
        <pubDate>Mon, 15 Sep 2025 20:27:19 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-9</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[goose4]]></dc:creator>
        <description><![CDATA[
            <p>Thanks for pointing that out</p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/8">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/8</link>
        <pubDate>Mon, 15 Sep 2025 20:21:01 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-8</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[arraybolt3]]></dc:creator>
        <description><![CDATA[
            <p>FWIW, CUPS doesn‚Äôt even appear to be installed on Kicksecure 17 by default, unless I accidentally uninstalled it in my development VM during other work:</p>
<pre><code class="lang-auto">[sysmaint ~]% apt list --installed | grep cups

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

libcups2/oldstable,oldstable-security,now 2.4.2-3+deb12u8 amd64 [installed,automatic]
</code></pre>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/7">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/7</link>
        <pubDate>Wed, 27 Aug 2025 20:47:30 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-7</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[Quiksilver]]></dc:creator>
        <description><![CDATA[
            <p>Honestly I really doubt upstream or Debian would add anything that disables network and LAN printing such as:</p>
<pre><code class="lang-auto">CapabilityBoundingSet=CAP_NET_BIND_SERVICE
PrivateNetwork=yes
</code></pre>
<p>However they might be accepting to <code>NoNewPrivileges=yes</code> and others.</p>
<p>People do indeed use network printing or LAN printing (I don‚Äôt do either personally) but maybe a new thread regarding CUPS should be made like ‚Äúshould CUPS even come disabled by default‚Äù or the ideas mentioned here.</p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/6">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/6</link>
        <pubDate>Wed, 27 Aug 2025 20:34:37 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-6</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>Yes, systemd configuration snippet drop-in support is amazing.</p>
<p>(As a distribution we should use folder <code>/usr/lib/systemd/system</code> rather than <code>/etc</code>.)</p>
<p>Any systemd hardening options:</p>
<ol>
<li>Please try to submit them upstream. (Such as to cups.) If that does not work,</li>
<li>Submit them to Debian.</li>
<li>Only then consider submitting these to Kicksecure.</li>
</ol>
<p>This is for the purpose of maintainability.</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.kicksecure.com/wiki/Dev/maintainability">
  <header class="source">
      <img src="https://www.kicksecure.com/favicon.svg?hsversion-headscript-replacement-by-server=1&amp;hsversion_from_server_replacement_unixtime=1756287028" class="site-icon" alt="" width="151" height="151">

      <a href="https://www.kicksecure.com/wiki/Dev/maintainability" target="_blank" rel="noopener" title="01:34PM - 25 August 2025">Kicksecure ‚Äì 25 Aug 25</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/387;"><img src="https://www.kicksecure.com/w/images/5/51/Kicksecure-image-twitter-post.jpg?version=30a0ad75271a4836786771c345c960b8" class="thumbnail" alt="" width="690" height="388"></div>

<h3><a href="https://www.kicksecure.com/wiki/Dev/maintainability" target="_blank" rel="noopener">Maintainability</a></h3>

  <p>Exploring the challenges of maintainability in the Kicksecure project and Open Source development.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>See also:</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://www.kicksecure.com/wiki/Dev/Relationship_With_Upstream">
  <header class="source">
      <img src="https://www.kicksecure.com/favicon.svg?hsversion-headscript-replacement-by-server=1&amp;hsversion_from_server_replacement_unixtime=1756287028" class="site-icon" alt="" width="151" height="151">

      <a href="https://www.kicksecure.com/wiki/Dev/Relationship_With_Upstream" target="_blank" rel="noopener" title="02:18PM - 07 August 2025">Kicksecure ‚Äì 7 Aug 25</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/387;"><img src="https://www.kicksecure.com/w/images/5/51/Kicksecure-image-twitter-post.jpg?version=30a0ad75271a4836786771c345c960b8" class="thumbnail" alt="" width="690" height="388"></div>

<h3><a href="https://www.kicksecure.com/wiki/Dev/Relationship_With_Upstream" target="_blank" rel="noopener">Relationship With Upstream</a></h3>

  <p>Kicksecure Relationship with Upstream Projects.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>This is not on our immediate roadmap: <a href="https://www.kicksecure.com/wiki/Security_Roadmap" class="inline-onebox">Kicksecure Security Roadmap</a></p>
<p>But anyone feel free to work on this.</p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/5">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/5</link>
        <pubDate>Wed, 27 Aug 2025 18:46:01 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-5</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[Quiksilver]]></dc:creator>
        <description><![CDATA[
            <p>Thanks for sharing this info I was not aware of this. <code>PrivateNetwork=yes/no</code> looks like a good option for CUPS and others we don‚Äôt need network access.</p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/4">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/4</link>
        <pubDate>Wed, 27 Aug 2025 18:13:47 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-4</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[Quiksilver]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="https://forums.kicksecure.com/u/arraybolt3">@arraybolt3</a><br>
On the USBGuard thread you mentioned CUPS, does systemd support a drop in file? it looks like documentation states it does?</p>
<blockquote>
<p>Along with a unit file foo.service, a ‚Äúdrop-in‚Äù directory foo.service.d/ may exist. All files with the suffix ‚Äú.conf‚Äù from this directory will be merged in the alphanumeric order and parsed after the main unit file itself has been parsed. This is useful to alter or add configuration settings for a unit, without having to modify unit files. Each drop-in file must contain appropriate section headers. For instantiated units, this logic will first look for the instance ‚Äú.d/‚Äù subdirectory (e.g. ‚Äúfoo@bar.service.d/‚Äù) and read its ‚Äú.conf‚Äù files, followed by the template ‚Äú.d/‚Äù subdirectory (e.g. ‚Äúfoo@.service.d/‚Äù) and the ‚Äú.conf‚Äù files there. Moreover, for unit names containing dashes (‚Äú-‚Äù), the set of directories generated by repeatedly truncating the unit name after all dashes is searched too. Specifically, for a unit name foo-bar-baz.service not only the regular drop-in directory foo-bar-baz.service.d/ is searched but also both foo-bar-.service.d/ and foo-.service.d/. This is useful for defining common drop-ins for a set of related units, whose names begin with a common prefix. This scheme is particularly useful for mount, automount and slice units, whose systematic naming structure is built around dashes as component separators. Note that equally named drop-in files further down the prefix hierarchy override those further up, i.e. foo-bar-.service.d/10-override.conf overrides foo-.service.d/10-override.conf.</p>
</blockquote>
<blockquote>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html" class="inline-onebox" rel="noopener nofollow ugc">systemd.unit</a></p>
</blockquote>
<p>Couldn‚Äôt we create a CUPS drop in <code>/etc/systemd/system/cups.service.d/hardening.conf</code> that would apply some hardened options that would essentially mitigate:</p>
<blockquote>
<p>WAN / public internet: a remote attacker sends an UDP packet to port 631. No authentication whatsoever.<br>
LAN: a local attacker can spoof zeroconf / mDNS / DNS-SD advertisements (we will talk more about this in the next writeup Ô£ø) and achieve the same code path leading to RCE.</p>
</blockquote>
<p>I don‚Äôt think the package manager would ever touch it either with upgrades to CUPS?</p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/3">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/3</link>
        <pubDate>Wed, 27 Aug 2025 18:12:18 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-3</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[arraybolt3]]></dc:creator>
        <description><![CDATA[
            <p>I don‚Äôt think we harden specific ‚Äúthird-party‚Äù services yet, but we definitely use these kinds of things for applicable services in Kicksecure and Whonix. See <a href="https://github.com/Kicksecure/sdwdate/blob/master/usr/lib/systemd/system/sdwdate.service" class="inline-onebox" rel="noopener nofollow ugc">sdwdate/usr/lib/systemd/system/sdwdate.service at master ¬∑ Kicksecure/sdwdate ¬∑ GitHub</a> for instance, there‚Äôs a whole battery of hardening options enabled here, including a syscall filter.</p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/2">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/2</link>
        <pubDate>Tue, 26 Aug 2025 02:21:16 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-2</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
      <item>
        <title>Systemd Service Hardening?</title>
        <dc:creator><![CDATA[goose4]]></dc:creator>
        <description><![CDATA[
            <p>So I was learning about the options for Systemd services for restricting or in another word ‚Äúhardening‚Äù services.</p>
<p>This made me question does Kicksecure deploy certain hardening for it‚Äôs services or certain Kicksecure specific services?</p>
<p>These are some interesting options I will note here:</p>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#PrivateNetwork=" rel="noopener nofollow ugc"><code>PrivateNetwork=yes/no</code></a><br>
Gives the service its own network namespace. It can‚Äôt see or use the host‚Äôs network interfaces unless you explicitly bind sockets. Seems useful to prevent leaks or prevent services from being ran without networking?</p>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#PrivatePIDs=" rel="noopener nofollow ugc"><code>PrivatePIDs=yes/no</code></a><br>
Gives a service an isolated view of the process table, which is a useful ‚Äúdefense in depth‚Äù measure, especially for daemons that don‚Äôt need to inspect or manage other system processes.</p>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#PrivateTmp=" rel="noopener nofollow ugc"><code>PrivateTmp=yes/no</code></a><br>
Provides a private /tmp and /var/tmp for the service, isolating it from the host‚Äôs temporary directories. One service can‚Äôt read temporary files left by another service, which mitigates attacks that rely on guessing or stealing temp‚Äëfile names.</p>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#MemoryDenyWriteExecute=" rel="noopener nofollow ugc"><code>MemoryDenyWriteExecute=yes/no</code></a><br>
Remounts parts of the filesystem read‚Äëonly (or makes the whole tree read‚Äëonly) for the service. (helps mitigate code‚Äëinjection attacks).</p>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#ProtectSystem=" rel="noopener nofollow ugc"><code>ProtectSystem=full/strict/yes</code></a><br>
Remounts parts of the filesystem read‚Äëonly (or makes the whole tree read‚Äëonly) for the service.</p>
<p>There is many others but these few caught my eye.</p>
          <p><a href="https://forums.kicksecure.com/t/systemd-service-hardening/1258/1">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/systemd-service-hardening/1258/1</link>
        <pubDate>Tue, 26 Aug 2025 01:47:58 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1258-1</guid>
        <source url="https://forums.kicksecure.com/t/systemd-service-hardening/1258.rss">Systemd Service Hardening?</source>
      </item>
  </channel>
</rss>
