<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Kicksecure for Qubes - HVM Issues</title>
    <link>https://forums.kicksecure.com/t/kicksecure-for-qubes-hvm-issues/1372</link>
    <description>[Kicksecure for Qubes - HVM](https://www.kicksecure.com/wiki/Qubes#HVM)

For reference only.

Note, the following issues are unspecific to Kicksecure. These are general Qubes HVM issues.

https://github.com/QubesOS/qubes-issues/issues/10424

https://github.com/QubesOS/qubes-issues/issues/10425

https://github.com/QubesOS/qubes-issues/issues/10426</description>
    
    <lastBuildDate>Sun, 23 Nov 2025 09:04:01 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="https://forums.kicksecure.com/t/kicksecure-for-qubes-hvm-issues/1372.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Kicksecure for Qubes - HVM Issues</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p><a href="https://www.kicksecure.com/wiki/Qubes#HVM">Kicksecure for Qubes - HVM</a></p>
<p>For reference only.</p>
<p>Note, the following issues are unspecific to Kicksecure. These are general Qubes HVM issues.</p>
<aside class="onebox githubissue" data-onebox-src="https://github.com/QubesOS/qubes-issues/issues/10424">
  <header class="source">

      <a href="https://github.com/QubesOS/qubes-issues/issues/10424" target="_blank" rel="noopener">github.com/QubesOS/qubes-issues</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/QubesOS/qubes-issues/issues/10424" target="_blank" rel="noopener">Emulated VGA in HVMs advertises resolutions that aren't actually supported by the VGA adapter</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2025-11-23" data-time="04:11:19" data-timezone="UTC">04:11AM - 23 Nov 25 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/ArrayBolt3" target="_blank" rel="noopener">
          <img alt="" src="https://avatars.githubusercontent.com/u/104878738?v=4" class="onebox-avatar-inline" width="20" height="20">
          ArrayBolt3
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          P: default
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">[How to file a helpful issue](https://www.qubes-os.org/doc/issue-tracking/)

###<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden"> Qubes OS release

R4.3

### Brief summary

Some of the resolutions advertised to HVMs by the VGA emulation aren't supported by the VGA emulation itself. One of those resolutions is 1366x768, which if actually set will result in a badly distorted flashy mess. This happens in arbitrary Linux distributions regardless of display server (X or Wayland) to my awareness; I can reproduce the issue on openSUSE Tumbleweed (both XFCE and GNOME) and Kicksecure 18. All show 1366x768 as available; Kicksecure and openSUSE Tumbleweed XFCE show distortion when set to these resolutions, while openSUSE Tumbleweed GNOME ends up set to 1360x768 when 1366x768 is requested.

### Steps to reproduce

1. Download an OpenSUSE live image from https://get.opensuse.org/tumbleweed/?type=desktop#download, which image doesn't matter.
2. Create a new HVM, set its memory to 4000/4000 MB, and disable memory balancing.
3. Boot the HVM from the downloaded ISO.
4. Look at the display resolution settings. 1366x768 will be advertised.
5. Set the resolution to 1366x768.

### Expected behavior

1366x768 either should not be advertised, or should work properly.

### Actual behavior

1366x768 is recognized, and when set it results in either a badly distorted, unusable display, or a slightly smaller display than expected.

### Additional information

This issue does not occur with QEMU 10.1.2 build from source on Kubuntu 24.04 (the 1366x768 display mode isn't advertised at all). Thus if this is a QEMU bug, it's probably fixed upstream already.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox githubissue" data-onebox-src="https://github.com/QubesOS/qubes-issues/issues/10425">
  <header class="source">

      <a href="https://github.com/QubesOS/qubes-issues/issues/10425" target="_blank" rel="noopener">github.com/QubesOS/qubes-issues</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/QubesOS/qubes-issues/issues/10425" target="_blank" rel="noopener">Allow setting video RAM for HVMs via qvm-features</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2025-11-23" data-time="04:17:39" data-timezone="UTC">04:17AM - 23 Nov 25 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/ArrayBolt3" target="_blank" rel="noopener">
          <img alt="" src="https://avatars.githubusercontent.com/u/104878738?v=4" class="onebox-avatar-inline" width="20" height="20">
          ArrayBolt3
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          P: default
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">[How to file a helpful issue](https://www.qubes-os.org/doc/issue-tracking/)

###<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden"> The problem you're addressing (if any)

The default quantity of VRAM available for HVMs (I believe 16 MB) is insufficient to support 1920x1080 with some display servers (notably labwc). Attempting to set this resolution will succeed, but the display server will lock up and spam memory allocation errors to the system log. Increasing video RAM to 64 MB fixes the issue, at the cost of increasing RAM consumption. This increased RAM consumption makes increasing the video RAM for all VMs on Qubes an undesirable solution, so the user should be able to customize the quantity of video RAM themselves. While technically this is doable already, it has to be done by creating a Jinja template for libvirt XML, as documented at https://dev.qubes-os.org/projects/core-admin/en/latest/libvirt.html. This is not easy for a user to do.

### The solution you'd like

Provide a new qvm-feature, `video-ram` or similar, that allows setting the amount of RAM allocated to the emulated VGA card in megabytes, similar to the `vgamem_mb` setting in QEMU.

### The value to a user and who that user might be

Users can take advantage of high VM display resolutions when using HVMs, without having to create a Jinja template.

### Completion criteria checklist

(This section is for developer use only. Please do not modify it.)</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox githubissue" data-onebox-src="https://github.com/QubesOS/qubes-issues/issues/10426">
  <header class="source">

      <a href="https://github.com/QubesOS/qubes-issues/issues/10426" target="_blank" rel="noopener">github.com/QubesOS/qubes-issues</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/QubesOS/qubes-issues/issues/10426" target="_blank" rel="noopener">Qubes HVM: add support for `virtio` (or other modern) graphic driver / device</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2025-11-23" data-time="09:03:00" data-timezone="UTC">09:03AM - 23 Nov 25 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/adrelanos" target="_blank" rel="noopener">
          <img alt="" src="https://avatars.githubusercontent.com/u/1985040?v=4" class="onebox-avatar-inline" width="20" height="20">
          adrelanos
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          P: default
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">### The problem you're addressing (if any)

Qubes HVMs do not support common or <span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">high resolutions. Would also probably solve:

* https://github.com/QubesOS/qubes-issues/issues/10424

### The solution you'd like

Support `virtio` graphic driver inside HVM or other modern virtual graphic device / driver.

### The value to a user and who that user might be

More compatible Qubes HVM and less failed boots for users such as black screen during boot.

### Additional information

From Matrix qubes-public channel.

Quote @arraybolt3 

&gt; @marmarek: Is there any way to pass custom parameters to the QEMU instance that HVMs run in? Not sure why we didn't run into this before, maybe it's kernel related, but it looks like labwc really, really hates the default VGA graphics that Qubes OS provides to VGA-enabled HVMs. This isn't Qubes-specific, I've seen the same behavior under QEMU/KVM on Kubuntu 24.04 also. I know that virtio graphics work, and would like to switch to those.

Quote @marmarek 

&gt; see qvm-features -&gt; video-model

Quote @arraybolt3

&gt; (the specific behavior is that labwc initially works, then freezes, and spams a lot of errors stating `connector Virtual-1: Atomic commit failed: Cannot allocate memory`

Quote @marmarek:

&gt; that said, I'm not sure if virtio will work here, but I guess you can try... but there are also other possible options

Quote @marmarek:

&gt; doesn't seem to have virtio support, but qxl is there, so maybe that will be enough.

Quote @arraybolt3:

&gt; sadly it looks like the only option supported other than the default vga or xen (which appears to be a synonym for vga) is cirrus, which does actually work but also has a max resolution of 1360x768. [...]

&gt; So it turns out that the issue is almost certainly that we now have code that resizes the window to 1920x1080 during bootup. labwc works just fine as 1024x768, and a few higher resolutions, but 1366x768 results in a horribly distorted display, 1600x900 did even weirder things, and 1920x1080 results in labwc freezing.

&gt; AFAICT the video-model option is just telling Xen what VGA hardware it should emulate, rather than using QEMU to do that part. Is there any way in which Qubes OS could use QEMU for graphics emulation instead, so that things like virtio would be available?

Quote @marmarek

&gt; Xen doesn't do any emulation, it's all in QEMU, and this option translates to QEMU cmdline. There is libvirt in between, which affects what options are supported. But as said before, even if virtio would be on the list, I doubt it would work with Xen...

&gt; Another thing is also vram attribute in libvirt xml, it defaults to 16MB, maybe that needs increasing? But for that we don't have qvm-features, it would need https://dev.qubes-os.org/projects/core-admin/en/latest/libvirt.html

### Related issues

* https://github.com/QubesOS/qubes-issues/issues/10424
* https://github.com/QubesOS/qubes-issues/issues/10425

### Completion criteria checklist

(This section is for developer use only. Please do not modify it.)</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/kicksecure-for-qubes-hvm-issues/1372/1">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/kicksecure-for-qubes-hvm-issues/1372/1</link>
        <pubDate>Sun, 23 Nov 2025 09:04:01 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-1372-1</guid>
        <source url="https://forums.kicksecure.com/t/kicksecure-for-qubes-hvm-issues/1372.rss">Kicksecure for Qubes - HVM Issues</source>
      </item>
  </channel>
</rss>
